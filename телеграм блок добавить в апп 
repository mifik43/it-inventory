1. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –∑–∞—è–≤–æ–∫
sql
-- [file name]: database.py (–¥–æ–±–∞–≤–∏—Ç—å –≤ init_db())
-- [file content begin]
CREATE TABLE IF NOT EXISTS telegram_requests (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    telegram_id INTEGER NOT NULL,
    username TEXT,
    first_name TEXT,
    last_name TEXT,
    message_text TEXT NOT NULL,
    message_type TEXT DEFAULT 'text',
    status TEXT DEFAULT 'new',
    priority TEXT DEFAULT 'normal',
    assigned_to INTEGER,
    category TEXT,
    contact_info TEXT,
    response_text TEXT,
    response_by INTEGER,
    response_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (assigned_to) REFERENCES users (id),
    FOREIGN KEY (response_by) REFERENCES users (id)
);

CREATE INDEX IF NOT EXISTS idx_telegram_requests_status ON telegram_requests(status);
CREATE INDEX IF NOT EXISTS idx_telegram_requests_created_at ON telegram_requests(created_at);
-- [file content end]
2. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram –∑–∞—è–≤–∫–∞–º–∏
python
# [file name]: telegram_utils.py
# [file content begin]
import requests
import json
from datetime import datetime
from database import get_db
from flask import current_app

class TelegramBot:
    def __init__(self, token=None, webhook_url=None):
        self.token = token
        self.webhook_url = webhook_url
        self.base_url = f"https://api.telegram.org/bot{token}/"

    def set_webhook(self):
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –¥–ª—è –±–æ—Ç–∞"""
        if not self.token or not self.webhook_url:
            return False, "–¢–æ–∫–µ–Ω –∏–ª–∏ URL webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        
        url = f"{self.base_url}setWebhook"
        data = {
            "url": self.webhook_url,
            "drop_pending_updates": True
        }
        
        try:
            response = requests.post(url, json=data)
            result = response.json()
            return result.get('ok', False), result.get('description', 'Unknown error')
        except Exception as e:
            return False, str(e)

    def send_message(self, chat_id, text, parse_mode='HTML', reply_markup=None):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
        if not self.token:
            return False, "–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        
        url = f"{self.base_url}sendMessage"
        data = {
            "chat_id": chat_id,
            "text": text,
            "parse_mode": parse_mode
        }
        
        if reply_markup:
            data['reply_markup'] = reply_markup
        
        try:
            response = requests.post(url, json=data)
            result = response.json()
            return result.get('ok', False), result
        except Exception as e:
            return False, str(e)

    def create_inline_keyboard(self, buttons):
        """–°–æ–∑–¥–∞–Ω–∏–µ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"""
        return {
            "inline_keyboard": buttons
        }

def save_telegram_request(telegram_data):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –∏–∑ Telegram –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
    db = get_db()
    
    try:
        message = telegram_data.get('message', {})
        chat = message.get('chat', {})
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
        telegram_id = chat.get('id')
        username = chat.get('username')
        first_name = chat.get('first_name')
        last_name = chat.get('last_name')
        message_text = message.get('text', '')
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        category = categorize_message(message_text)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—è–≤–∫—É
        cursor = db.execute('''
            INSERT INTO telegram_requests 
            (telegram_id, username, first_name, last_name, message_text, category)
            VALUES (?, ?, ?, ?, ?, ?)
        ''', (telegram_id, username, first_name, last_name, message_text, category))
        
        request_id = cursor.lastrowid
        db.commit()
        
        return True, request_id
        
    except Exception as e:
        return False, str(e)

def categorize_message(text):
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º"""
    text_lower = text.lower()
    
    categories = {
        'wifi': ['wifi', '–≤–∞–π—Ñ–∞–π', '–∏–Ω—Ç–µ—Ä–Ω–µ—Ç', '—Å–µ—Ç—å', '–ø–æ–¥–∫–ª—é—á–∏—Ç—å', '–ø–∞—Ä–æ–ª—å'],
        'hardware': ['–∫–æ–º–ø—å—é—Ç–µ—Ä', '–Ω–æ—É—Ç–±—É–∫', '–ø—Ä–∏–Ω—Ç–µ—Ä', '–º–æ–Ω–∏—Ç–æ—Ä', '–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞', '–º—ã—à—å', '—Ä–µ–º–æ–Ω—Ç'],
        'software': ['–ø—Ä–æ–≥—Ä–∞–º–º–∞', '—Å–æ—Ñ—Ç', '—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å', '–ª–∏—Ü–µ–Ω–∑–∏—è', 'windows', 'office'],
        'access': ['–¥–æ—Å—Ç—É–ø', '–ª–æ–≥–∏–Ω', '–ø–∞—Ä–æ–ª—å', '—É—á–µ—Ç–∫–∞', '–∞–∫–∫–∞—É–Ω—Ç'],
        'phone': ['—Ç–µ–ª–µ—Ñ–æ–Ω', '–∑–≤–æ–Ω–æ–∫', '—Å–≤—è–∑—å', '–º–æ–±–∏–ª—å–Ω—ã–π'],
        'other': []
    }
    
    for category, keywords in categories.items():
        if any(keyword in text_lower for keyword in keywords):
            return category
    
    return 'other'

def get_telegram_requests(status=None, limit=50):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –∏–∑ Telegram"""
    db = get_db()
    
    query = '''
        SELECT tr.*, 
               u1.username as assigned_username,
               u2.username as response_username
        FROM telegram_requests tr
        LEFT JOIN users u1 ON tr.assigned_to = u1.id
        LEFT JOIN users u2 ON tr.response_by = u2.id
    '''
    
    params = []
    if status:
        query += ' WHERE tr.status = ?'
        params.append(status)
    
    query += ' ORDER BY tr.created_at DESC LIMIT ?'
    params.append(limit)
    
    return db.execute(query, params).fetchall()

def update_request_status(request_id, status, user_id=None):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏"""
    db = get_db()
    
    try:
        db.execute('''
            UPDATE telegram_requests 
            SET status = ?, updated_at = CURRENT_TIMESTAMP
            WHERE id = ?
        ''', (status, request_id))
        
        db.commit()
        return True
    except Exception as e:
        return False

def assign_request(request_id, user_id):
    """–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    db = get_db()
    
    try:
        db.execute('''
            UPDATE telegram_requests 
            SET assigned_to = ?, status = 'assigned', updated_at = CURRENT_TIMESTAMP
            WHERE id = ?
        ''', (user_id, request_id))
        
        db.commit()
        return True
    except Exception as e:
        return False

def add_response(request_id, response_text, user_id):
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∫ –∑–∞—è–≤–∫–µ"""
    db = get_db()
    
    try:
        db.execute('''
            UPDATE telegram_requests 
            SET response_text = ?, response_by = ?, response_at = CURRENT_TIMESTAMP,
                status = 'completed', updated_at = CURRENT_TIMESTAMP
            WHERE id = ?
        ''', (response_text, user_id, request_id))
        
        db.commit()
        return True
    except Exception as e:
        return False

def get_request_stats():
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞—è–≤–∫–∞–º"""
    db = get_db()
    
    stats = db.execute('''
        SELECT 
            COUNT(*) as total,
            SUM(CASE WHEN status = 'new' THEN 1 ELSE 0 END) as new_count,
            SUM(CASE WHEN status = 'assigned' THEN 1 ELSE 0 END) as assigned_count,
            SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed_count,
            COUNT(DISTINCT telegram_id) as unique_users
        FROM telegram_requests
    ''').fetchone()
    
    return dict(stats) if stats else {}
# [file content end]
3. –î–æ–±–∞–≤–∏–º –º–∞—Ä—à—Ä—É—Ç—ã –≤ app.py
python
# [file name]: app.py
# [file content begin]
# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–º–ø–æ—Ä—Ç—ã ...

from telegram_utils import (
    save_telegram_request, get_telegram_requests, update_request_status,
    assign_request, add_response, get_request_stats, TelegramBot
)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞
TELEGRAM_BOT_TOKEN = 'YOUR_BOT_TOKEN_HERE'  # –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
TELEGRAM_WEBHOOK_URL = 'https://your-domain.com/webhook/telegram'  # –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π URL

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
telegram_bot = TelegramBot(token=TELEGRAM_BOT_TOKEN, webhook_url=TELEGRAM_WEBHOOK_URL)

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

# ========== –ú–ê–†–®–†–£–¢–´ –î–õ–Ø TELEGRAM –ó–ê–Ø–í–û–ö ==========

@app.route('/webhook/telegram', methods=['POST'])
def telegram_webhook():
    """Webhook –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Telegram –±–æ—Ç–∞"""
    try:
        data = request.get_json()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if 'message' in data and 'text' in data['message']:
            success, result = save_telegram_request(data)
            
            if success:
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                chat_id = data['message']['chat']['id']
                message_text = "‚úÖ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è."
                
                telegram_bot.send_message(chat_id, message_text)
                
                return jsonify({'status': 'success'}), 200
            else:
                return jsonify({'status': 'error', 'message': str(result)}), 500
        
        return jsonify({'status': 'ignored'}), 200
        
    except Exception as e:
        current_app.logger.error(f"Telegram webhook error: {str(e)}")
        return jsonify({'status': 'error', 'message': str(e)}), 500

@app.route('/telegram_requests')
@login_required
def telegram_requests():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –∑–∞—è–≤–æ–∫ –∏–∑ Telegram"""
    status_filter = request.args.get('status', '')
    page = request.args.get('page', 1, type=int)
    per_page = 20
    
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞—è–≤–∫–∏
    if status_filter:
        requests_list = get_telegram_requests(status=status_filter, limit=per_page)
    else:
        requests_list = get_telegram_requests(limit=per_page)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    stats = get_request_stats()
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
    db = get_db()
    users = db.execute('SELECT id, username FROM users WHERE role IN ("admin", "user")').fetchall()
    
    return render_template('telegram/requests.html',
                         requests=requests_list,
                         stats=stats,
                         users=users,
                         status_filter=status_filter,
                         current_page=page)

@app.route('/telegram_request/<int:request_id>')
@login_required
def view_telegram_request(request_id):
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞—è–≤–∫–∏"""
    db = get_db()
    
    request_data = db.execute('''
        SELECT tr.*, 
               u1.username as assigned_username,
               u2.username as response_username
        FROM telegram_requests tr
        LEFT JOIN users u1 ON tr.assigned_to = u1.id
        LEFT JOIN users u2 ON tr.response_by = u2.id
        WHERE tr.id = ?
    ''', (request_id,)).fetchone()
    
    if not request_data:
        flash('–ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error')
        return redirect(url_for('telegram_requests'))
    
    return render_template('telegram/view_request.html', request=request_data)

@app.route('/update_request_status/<int:request_id>', methods=['POST'])
@login_required
def update_telegram_request_status(request_id):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏"""
    new_status = request.form.get('status')
    
    if not new_status:
        flash('–°—Ç–∞—Ç—É—Å –Ω–µ —É–∫–∞–∑–∞–Ω', 'error')
        return redirect(url_for('view_telegram_request', request_id=request_id))
    
    success = update_request_status(request_id, new_status, session['user_id'])
    
    if success:
        flash('–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success')
    else:
        flash('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞', 'error')
    
    return redirect(url_for('view_telegram_request', request_id=request_id))

@app.route('/assign_request/<int:request_id>', methods=['POST'])
@login_required
def assign_telegram_request(request_id):
    """–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = request.form.get('user_id')
    
    if not user_id:
        flash('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error')
        return redirect(url_for('view_telegram_request', request_id=request_id))
    
    success = assign_request(request_id, user_id)
    
    if success:
        flash('–ó–∞—è–≤–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞', 'success')
    else:
        flash('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏', 'error')
    
    return redirect(url_for('view_telegram_request', request_id=request_id))

@app.route('/add_response/<int:request_id>', methods=['POST'])
@login_required
def add_telegram_response(request_id):
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∫ –∑–∞—è–≤–∫–µ"""
    response_text = request.form.get('response_text')
    
    if not response_text:
        flash('–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º', 'error')
        return redirect(url_for('view_telegram_request', request_id=request_id))
    
    success = add_response(request_id, response_text, session['user_id'])
    
    if success:
        flash('–û—Ç–≤–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω', 'success')
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram
        db = get_db()
        request_data = db.execute('SELECT telegram_id FROM telegram_requests WHERE id = ?', (request_id,)).fetchone()
        
        if request_data and TELEGRAM_BOT_TOKEN:
            telegram_bot.send_message(
                request_data['telegram_id'],
                f"üì® –û—Ç–≤–µ—Ç –ø–æ –≤–∞—à–µ–π –∑–∞—è–≤–∫–µ:\n\n{response_text}"
            )
    else:
        flash('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞', 'error')
    
    return redirect(url_for('view_telegram_request', request_id=request_id))

@app.route('/setup_telegram_webhook')
@admin_required
def setup_telegram_webhook():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –¥–ª—è Telegram –±–æ—Ç–∞"""
    if not TELEGRAM_BOT_TOKEN or not TELEGRAM_WEBHOOK_URL:
        flash('–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–ª–∏ URL webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω', 'error')
        return redirect(url_for('telegram_requests'))
    
    success, message = telegram_bot.set_webhook()
    
    if success:
        flash(f'Webhook —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω: {message}', 'success')
    else:
        flash(f'–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook: {message}', 'error')
    
    return redirect(url_for('telegram_requests'))

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
# [file content end]
4. –î–æ–±–∞–≤–∏–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –¥–ª—è –∑–∞—è–≤–æ–∫
html
<!-- [file name]: navigation.html -->
<!-- [file content begin] -->
<!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ... -->

<!-- Telegram Requests -->
<li class="nav-item">
    <a class="nav-link {% if request.endpoint in ['telegram_requests', 'view_telegram_request'] %}active{% endif %}" 
       href="{{ url_for('telegram_requests') }}">
        <i class="bi bi-telegram"></i>
        –ó–∞—è–≤–∫–∏ –∏–∑ Telegram
        {% if get_telegram_requests(status='new')|length > 0 %}
        <span class="badge bg-danger rounded-pill float-end">
            {{ get_telegram_requests(status='new')|length }}
        </span>
        {% endif %}
    </a>
</li>

<!-- ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ... -->
<!-- [file content end] -->
5. –°–æ–∑–¥–∞–¥–∏–º —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∑–∞—è–≤–æ–∫
–û—Å–Ω–æ–≤–Ω–æ–π —à–∞–±–ª–æ–Ω —Å–ø–∏—Å–∫–∞ –∑–∞—è–≤–æ–∫
html
<!-- [file name]: requests.html -->
<!-- [file content begin] -->
{% extends "base.html" %}

{% block title %}–ó–∞—è–≤–∫–∏ –∏–∑ Telegram{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-telegram me-2"></i>–ó–∞—è–≤–∫–∏ –∏–∑ Telegram</h2>
    <div>
        {% if session.role == 'admin' %}
        <a href="{{ url_for('setup_telegram_webhook') }}" class="btn btn-outline-info me-2">
            <i class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook
        </a>
        {% endif %}
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-chat-dots fs-3 me-3"></i>
                    <div>
                        <h4 class="mb-0">{{ stats.total or 0 }}</h4>
                        <small>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-clock fs-3 me-3"></i>
                    <div>
                        <h4 class="mb-0">{{ stats.new_count or 0 }}</h4>
                        <small>–ù–æ–≤—ã—Ö</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-person-check fs-3 me-3"></i>
                    <div>
                        <h4 class="mb-0">{{ stats.assigned_count or 0 }}</h4>
                        <small>–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-check-circle fs-3 me-3"></i>
                    <div>
                        <h4 class="mb-0">{{ stats.completed_count or 0 }}</h4>
                        <small>–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="card bg-secondary text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-people fs-3 me-3"></i>
                    <div>
                        <h4 class="mb-0">{{ stats.unique_users or 0 }}</h4>
                        <small>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">–§–∏–ª—å—Ç—Ä—ã</h6>
    </div>
    <div class="card-body">
        <div class="btn-group" role="group">
            <a href="{{ url_for('telegram_requests') }}" 
               class="btn btn-outline-primary {% if not status_filter %}active{% endif %}">
                –í—Å–µ
            </a>
            <a href="{{ url_for('telegram_requests', status='new') }}" 
               class="btn btn-outline-warning {% if status_filter == 'new' %}active{% endif %}">
                –ù–æ–≤—ã–µ
            </a>
            <a href="{{ url_for('telegram_requests', status='assigned') }}" 
               class="btn btn-outline-info {% if status_filter == 'assigned' %}active{% endif %}">
                –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ
            </a>
            <a href="{{ url_for('telegram_requests', status='completed') }}" 
               class="btn btn-outline-success {% if status_filter == 'completed' %}active{% endif %}">
                –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
            </a>
        </div>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
<div class="card shadow">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h6>
        <span class="badge bg-primary">–í—Å–µ–≥–æ: {{ requests|length }}</span>
    </div>
    <div class="card-body">
        {% if requests %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                        <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in requests %}
                    <tr>
                        <td>{{ req.id }}</td>
                        <td>
                            <div>
                                <strong>
                                    {% if req.first_name or req.last_name %}
                                        {{ req.first_name or '' }} {{ req.last_name or '' }}
                                    {% else %}
                                        {{ req.username or '–ë–µ–∑ –∏–º–µ–Ω–∏' }}
                                    {% endif %}
                                </strong>
                                {% if req.username %}
                                <br><small class="text-muted">@{{ req.username }}</small>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            <div class="message-preview">
                                {{ req.message_text|truncate(100) }}
                            </div>
                        </td>
                        <td>
                            <span class="badge 
                                {% if req.status == 'new' %}bg-warning
                                {% elif req.status == 'assigned' %}bg-info
                                {% elif req.status == 'completed' %}bg-success
                                {% else %}bg-secondary{% endif %}">
                                {{ req.status }}
                            </span>
                            {% if req.assigned_username %}
                            <br><small class="text-muted">{{ req.assigned_username }}</small>
                            {% endif %}
                        </td>
                        <td>
                            {% if req.category %}
                            <span class="badge bg-light text-dark">{{ req.category }}</span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ req.created_at[:16] }}</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('view_telegram_request', request_id=req.id) }}" 
                                   class="btn btn-outline-primary">
                                    <i class="bi bi-eye"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h4 class="text-muted mt-3">–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p class="text-muted">–ù–µ—Ç –∑–∞—è–≤–æ–∫, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
.message-preview {
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
</style>
{% endblock %}
<!-- [file content end] -->
–®–∞–±–ª–æ–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞—è–≤–∫–∏
html
<!-- [file name]: view_request.html -->
<!-- [file content begin] -->
{% extends "base.html" %}

{% block title %}–ó–∞—è–≤–∫–∞ #{{ request.id }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-telegram me-2"></i>–ó–∞—è–≤–∫–∞ #{{ request.id }}</h2>
    <a href="{{ url_for('telegram_requests') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
    </a>
</div>

<div class="row">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="col-md-8">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-start mb-4">
                    <div class="flex-shrink-0">
                        <i class="bi bi-person-circle fs-1 text-primary"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h5 class="mt-0">
                            {% if request.first_name or request.last_name %}
                                {{ request.first_name or '' }} {{ request.last_name or '' }}
                            {% else %}
                                {{ request.username or '–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' }}
                            {% endif %}
                            {% if request.username %}
                            <small class="text-muted">@{{ request.username }}</small>
                            {% endif %}
                        </h5>
                        <p class="mb-1"><strong>Telegram ID:</strong> {{ request.telegram_id }}</p>
                        <p class="mb-1"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> 
                            {% if request.category %}
                            <span class="badge bg-light text-dark">{{ request.category }}</span>
                            {% else %}
                            <span class="text-muted">–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</span>
                            {% endif %}
                        </p>
                        <p class="mb-0"><strong>–î–∞—Ç–∞:</strong> {{ request.created_at }}</p>
                    </div>
                </div>
                
                <div class="message-content bg-light p-3 rounded">
                    <p class="mb-0">{{ request.message_text }}</p>
                </div>
            </div>
        </div>

        <!-- –û—Ç–≤–µ—Ç –Ω–∞ –∑–∞—è–≤–∫—É -->
        {% if request.response_text %}
        <div class="card shadow mb-4 border-success">
            <div class="card-header py-3 bg-success text-white">
                <h6 class="m-0 font-weight-bold">–û—Ç–≤–µ—Ç –Ω–∞ –∑–∞—è–≤–∫—É</h6>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="flex-shrink-0">
                        <i class="bi bi-person-check fs-1 text-success"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h5 class="mt-0">{{ request.response_username }}</h5>
                        <p class="text-muted mb-2">–û—Ç–≤–µ—Ç –¥–∞–Ω: {{ request.response_at }}</p>
                        <div class="response-content bg-light p-3 rounded">
                            <p class="mb-0">{{ request.response_text }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- –§–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ -->
        {% if request.status != 'completed' %}
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∑–∞—è–≤–∫—É</h6>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_telegram_response', request_id=request.id) }}">
                    <div class="mb-3">
                        <label for="response_text" class="form-label">–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞</label>
                        <textarea class="form-control" id="response_text" name="response_text" 
                                  rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-send"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
                    </button>
                </form>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="col-md-4">
        <!-- –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–æ–π</h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label"><strong>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:</strong></label>
                    <div class="mb-2">
                        <span class="badge 
                            {% if request.status == 'new' %}bg-warning
                            {% elif request.status == 'assigned' %}bg-info
                            {% elif request.status == 'completed' %}bg-success
                            {% else %}bg-secondary{% endif %} fs-6">
                            {{ request.status }}
                        </span>
                    </div>
                    
                    <form method="POST" action="{{ url_for('update_telegram_request_status', request_id=request.id) }}" class="mb-3">
                        <div class="mb-2">
                            <label class="form-label">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å:</label>
                            <select name="status" class="form-select">
                                <option value="new" {% if request.status == 'new' %}selected{% endif %}>–ù–æ–≤–∞—è</option>
                                <option value="assigned" {% if request.status == 'assigned' %}selected{% endif %}>–ù–∞–∑–Ω–∞—á–µ–Ω–∞</option>
                                <option value="completed" {% if request.status == 'completed' %}selected{% endif %}>–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-outline-primary btn-sm">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    </form>
                </div>

                <!-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ -->
                <div class="mb-3">
                    <label class="form-label"><strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∞ –Ω–∞:</strong></label>
                    <div class="mb-2">
                        {% if request.assigned_username %}
                        <span class="badge bg-info">{{ request.assigned_username }}</span>
                        {% else %}
                        <span class="text-muted">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞</span>
                        {% endif %}
                    </div>
                    
                    <form method="POST" action="{{ url_for('assign_telegram_request', request_id=request.id) }}">
                        <div class="mb-2">
                            <label class="form-label">–ù–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞:</label>
                            <select name="user_id" class="form-select">
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è --</option>
                                {% for user in users %}
                                <option value="{{ user.id }}" {% if request.assigned_to == user.id %}selected{% endif %}>
                                    {{ user.username }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-outline-info btn-sm">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                    </form>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="mt-4">
                    <h6>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—è–≤–∫–µ:</h6>
                    <ul class="list-unstyled small">
                        <li><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> {{ request.created_at }}</li>
                        <li><strong>–û–±–Ω–æ–≤–ª–µ–Ω–∞:</strong> {{ request.updated_at }}</li>
                        {% if request.response_at %}
                        <li><strong>–û—Ç–≤–µ—Ç –¥–∞–Ω:</strong> {{ request.response_at }}</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    {% if request.status != 'completed' %}
                    <form method="POST" action="{{ url_for('update_telegram_request_status', request_id=request.id) }}">
                        <input type="hidden" name="status" value="completed">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="bi bi-check-circle"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞—è–≤–∫—É
                        </button>
                    </form>
                    {% endif %}
                    
                    <a href="{{ url_for('telegram_requests') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-list"></i> –ö —Å–ø–∏—Å–∫—É –∑–∞—è–≤–æ–∫
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
<!-- [file content end] -->
6. –û–±–Ω–æ–≤–∏–º –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞—è–≤–æ–∫
python
# [file name]: app.py (–≤ —Ñ—É–Ω–∫—Ü–∏—é index())
# [file content begin]
# ... –≤ —Ñ—É–Ω–∫—Ü–∏–∏ index() –¥–æ–±–∞–≤–∏—Ç—å ...

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ Telegram –∑–∞—è–≤–∫–∞–º
telegram_stats = get_request_stats()
new_requests_count = telegram_stats.get('new_count', 0)
total_requests_count = telegram_stats.get('total', 0)

# ... –≤ return render_template –¥–æ–±–∞–≤–∏—Ç—å ...
telegram_stats=telegram_stats,
new_requests_count=new_requests_count,
total_requests_count=total_requests_count,
# [file content end]
–ò –¥–æ–±–∞–≤–∏—Ç—å –≤ index.html –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –∑–∞—è–≤–æ–∫:

html
<!-- [file name]: index.html -->
<!-- [file content begin] -->
<!-- –í —Ä–∞–∑–¥–µ–ª–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–æ–±–∞–≤–∏—Ç—å -->

<!-- Telegram –ó–∞—è–≤–∫–∏ -->
<div class="col-xl-2 col-md-4 mb-4">
    <div class="card border-left-danger shadow h-100 py-2">
        <div class="card-body">
            <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                    <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                        –ó–∞—è–≤–∫–∏ –∏–∑ Telegram</div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                        {{ new_requests_count }}/{{ total_requests_count }}
                    </div>
                    <div class="text-xs text-muted mt-1">
                        –Ω–æ–≤—ã—Ö/–≤—Å–µ–≥–æ
                    </div>
                </div>
                <div class="col-auto">
                    <i class="bi bi-telegram fa-2x text-gray-300"></i>
                </div>
            </div>
            <div class="mt-2 text-center">
                <a href="{{ url_for('telegram_requests') }}" class="btn btn-sm btn-outline-danger">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>
    </div>
</div>
<!-- [file content end] -->
7. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞:
–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather:

–û—Ç–ø—Ä–∞–≤—å—Ç–µ /newbot

–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ username –±–æ—Ç–∞

–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ app.py:

python
TELEGRAM_BOT_TOKEN = '–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞'
TELEGRAM_WEBHOOK_URL = 'https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webhook/telegram'
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook:

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: /setup_telegram_webhook (—Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é: https://api.telegram.org/bot<–≤–∞—à_—Ç–æ–∫–µ–Ω>/setWebhook?url=<–≤–∞—à_webhook_url>

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Telegram

‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º

‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

‚úÖ –û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É

‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ –∏–∑ Telegram!